---
# Claude Orchestrator Workflow (Reusable) - FIXED
#
# PURPOSE: This workflow orchestrates Claude AI interactions by providing
# a simple, reliable interface to the claude-executor. Consumer repositories
# handle their own webhook triggers and call this workflow.
#
# WHY: The original orchestrator design was flawed because workflow_call
# loses the original event context. This version is a lightweight wrapper
# that works reliably as a reusable workflow.
#
# ARCHITECTURE: Consumer repositories handle webhook events and conditional
# logic, then call this workflow with the appropriate trigger mode and configuration.
#
# USAGE: This is a reusable workflow that can be called from any repository
# with repository-specific configurations.

name: Claude Orchestrator (Reusable)

on:
  workflow_call:
    inputs:
      trigger_mode:
        description: 'Trigger mode: interactive or automatic'
        required: true
        type: string
      direct_prompt:
        description: 'Direct prompt for automatic mode'
        required: false
        type: string
      allowed_tools:
        description: 'Allowed tools configuration'
        required: false
        type: string
        default: |
          Bash(git status)
          Bash(git diff)
      timeout_minutes:
        description: 'Timeout in minutes for Claude execution'
        required: false
        type: number
        default: 15
      runner:
        description: 'GitHub runner to use'
        required: false
        type: string
        default: 'ubuntu-latest'
    secrets:
      ANTHROPIC_API_KEY:
        required: true

jobs:
  claude-execution:
    uses: ./.github/workflows/claude-executor.yml
    with:
      trigger_mode: ${{ inputs.trigger_mode }}
      direct_prompt: ${{ inputs.direct_prompt }}
      allowed_tools: ${{ inputs.allowed_tools }}
      timeout_minutes: ${{ inputs.timeout_minutes }}
      runner: ${{ inputs.runner }}
    secrets:
      ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}