---
# Claude Executor Workflow (Reusable)
#
# PURPOSE: This is the execution engine that runs Claude AI actions.
# This is the reusable version that will be hosted in dotCMS/claude-workflows
#
# WHY: This workflow contains the shared configuration and execution logic
# for all Claude interactions. It's designed to be reusable across different
# repositories and trigger scenarios.
#
# ROLE:
# - Sets up the execution environment (permissions, timeouts, runner)
# - Configures the anthropics/claude-code-action with configurable allowed tools
# - Handles the actual Claude AI interaction
# - Provides a single source of truth for Claude execution configuration
#
# USAGE: Called by orchestrator workflows with different parameters
# for interactive vs automatic modes and different tool configurations.

name: Claude Executor (Reusable)

on:
  workflow_call:
    inputs:
      trigger_mode:
        description: 'Mode of trigger - interactive or automatic'
        required: true
        type: string
      direct_prompt:
        description: 'Direct prompt for automatic reviews'
        required: false
        type: string
        default: ''
      allowed_tools:
        description: 'Custom allowed tools configuration'
        required: false
        type: string
        default: |
          Bash(git status)
          Bash(git diff)
      timeout_minutes:
        description: 'Timeout in minutes for the Claude execution'
        required: false
        type: number
        default: 15
      runner:
        description: 'GitHub runner to use'
        required: false
        type: string
        default: 'ubuntu-latest'
    secrets:
      ANTHROPIC_API_KEY:
        required: true

jobs:
  claude:
    runs-on: ${{ inputs.runner }}
    timeout-minutes: ${{ inputs.timeout_minutes }}
    permissions:
      contents: write
      pull-requests: write
      issues: write
      id-token: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - name: Run Claude Code
        id: claude
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          direct_prompt: ${{ inputs.direct_prompt }}
          allowed_tools: ${{ inputs.allowed_tools }}